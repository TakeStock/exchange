import sys;
from logging import Logger;

class Exchange(object):
	logger = Logger('Exchange');

	def main(s):
		s.logger.Info('Welcome to the Take Stock Exchange :)');

		args = sys.argv;
		command = args[1];

		option = {
			'test' : s.test, 
			'host' : s.host,
		}[command];

		option(args);

	def test(s, args):
		s.logger.Info('test');

	def host(s, args):
		s.logger.Info('Hosting exchange...');
		
		while(True):
			processEmails();

	def processEmails(s):
		s.logger.Info("Processing emails");		
		# check if any emails are in the queue

	def connectToMailServer(s, user, password):
		mailbox = poplib.POP3_SSL('pop.googlemail.com');
		mailbox.user(user);
		mailbox.pass_(password);
		print('Successfully connected');
		return mailbox;
	
	def readEmail(s):
		mailbox = connect();
	
		(response, rawLines, bytes) = mailbox.retr(4);
		rawString = '\n'.join(str(l)[2:-1] for l in rawLines);
		mail = email.message_from_string(rawString);
	
		parts = mail.get_payload()[0]
	
		for part in mail.walk():
			if part.get_content_type() == 'text/plain':
				body = part.get_payload();
	
		return [mail['from'], mail['subject'], body];
	
	def sendEmail(s, to, subject, body):
		email = MIMEText(body);
		email['subject'] = subject;
		email['from'] = exchangeEmail;
		email['to'] = to;
	
		smtp = smtplib.SMTP('smtp.gmail.com');
		smtp.starttls();
		smtp.login(exchangeEmail, exchangePass);
		smtp.sendmail(exchangeEmail, to, email.as_string());
		smtp.quit();
	
		
		
e = Exchange();
e.main();
